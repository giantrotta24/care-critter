# Care Critter (MVP)

A mobile-first Tamagotchi-style virtual pet built with React + TypeScript + Vite. The app mirrors pet care actions to real-world child habits through parent-configurable mirror prompts.

## Stack

- React 18 + TypeScript + Vite
- CSS (mobile-first)
- PWA via `vite-plugin-pwa` (installable, offline-capable after first load)
- Persistence: `localStorage` (adapter-based storage abstraction, so IndexedDB can replace it later)
- Tests: Vitest

## Features

- Single-screen mobile UI with no required scrolling on common phone sizes
- Pet lifecycle: `Egg -> Baby -> Child -> Teen -> Adult`
- Main meters: Hunger, Happiness, Training
- Primary actions: Feed (Meal/Snack), Play minigame, Learn minigame, Sleep
- Mirror prompt gating before rewards (for Play/Learn, prompt runs before the minigame)
- Parent Mode (hidden 2-second hold + math gate)
- Parent settings:
  - Mirror on/off
  - Confirm mode + timer
  - Per-action prompt text
  - Pause decay
  - Sleep window
  - Sleep override
  - Reset game
  - Export/import JSON backup
- Secondary care:
  - Poop accumulation + clean action
  - Sickness model + medicine cure (1-2 steps)
  - Attention demand + praise/scold
- Gentle death flow with restart

## Quick Start

### 1) Install

```bash
pnpm install
```

### 2) Run (dev)

```bash
pnpm dev
```

### 3) Build

```bash
pnpm build
```

### 4) Preview production build

```bash
pnpm preview
```

### 5) Test

```bash
pnpm test:ci
```

## PWA / Offline / Install

- Manifest is available at `public/manifest.webmanifest` (also generated by Vite PWA plugin config).
- Placeholder app icons are in `public/icons/`.
- Service worker is registered in `src/pwa.ts`.
- After first successful load, the app is cached for offline play.
- On mobile, use browser “Add to Home Screen” / install prompt.

## Game Logic Summary

Core logic lives in pure functions in `src/game/engine.ts`:

- `createInitialState(nowTs)`
- `applyTimeDecay(state, deltaMinutes, nowTs)`
- `advanceStageIfNeeded(state, nowTs)`
- `applyActionReward(state, actionType, outcome, nowTs)`
- `maybeSpawnPoop(state, deltaMinutes)`
- `updateSickness(state, deltaMinutes, nowTs)`

Persistence lives in `src/game/storage.ts`:

- `loadState(adapter?, nowTs?)`
- `saveState(state, adapter?)`

All tunable constants are centralized in `src/game/constants.ts`.

## Decay + Stage Rules (MVP)

- Hunger decays fastest, happiness medium, training slow.
- Sleep reduces decay rates.
- Poop increases happiness decay and sickness risk.
- Sickness reduces reward effectiveness and can lead to death if untreated while critical.
- Stage durations:
  - Egg: 5 minutes
  - Baby: 1 day
  - Child: 2 days
  - Teen: 2 days
  - Adult: indefinite
- Age (`ageDays`) increments by local-midnight day boundary.

## Project Structure

```text
.
├── public/
│   ├── icons/
│   └── manifest.webmanifest
├── src/
│   ├── components/
│   ├── game/
│   │   ├── constants.ts
│   │   ├── engine.ts
│   │   ├── reducer.ts
│   │   ├── storage.ts
│   │   ├── time.ts
│   │   └── types.ts
│   ├── styles/
│   ├── App.tsx
│   ├── main.tsx
│   └── pwa.ts
├── tests/
│   ├── engine.test.ts
│   └── storage.test.ts
├── index.html
├── package.json
├── vite.config.ts
└── README.md
```

## Deploy (Free: Preview + Production)

Recommended: **Vercel Hobby** (free)

- Preview deployments: every PR and commit
- Production deployment: `main` branch

Steps:

1. Push this repo to GitHub.
2. In Vercel, click **Add New Project** and import the GitHub repo.
3. Build settings are auto-detected from `vercel.json`:
   - Install: `pnpm install --frozen-lockfile`
   - Build: `pnpm build`
   - Output: `dist`
4. Set production branch to `main`.
5. Open the generated Vercel domain for production. PRs/commits will get preview URLs automatically.

If you prefer Netlify, the same repo works there as a Vite static site with free branch/PR previews.
